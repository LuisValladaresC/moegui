{% extends "./partials/layout.html" %}

{% block page_title %} 
  <title>{{ careers.page__title }}</title>
{% endblock %}

{% block css_plugins %}
  <!-- CSS Implementing Plugins -->
  <!-- bundlecss:vendor [@@autopath] -->
  <link rel="stylesheet" href="@@autopath/assets/vendor/fontawesome/css/all.min.css"> <!-- General --> {# Content.FontAwesome #}
  <link rel="stylesheet" href="@@autopath/assets/vendor/hs-mega-menu/dist/hs-mega-menu.min.css"> <!-- Header --> {# HSLibraries.HeaderMegaMenu #}
{% endblock %}

{% block content %}
  {% include "./partials/header.html" %}

	<!-- ========== MAIN ========== -->
	<main id="content" role="main">
    <!-- Hero Section --> {# Gallery.Component#4 #}
    <div class="position-relative">
      <div class="container space-top-3 space-top-lg-4 space-bottom-md-1 position-relative z-index-2">
        <div class="w-md-80 w-lg-60 text-center mx-md-auto mb-9">
          <div class="mb-5">
            <h1>{{ careers.hero__title }}</h1>
            <p>{{ careers.hero__description }}</p>
          </div>
          <a class="js-go-to btn btn-primary btn-wide transition-3d-hover" href="javascript:;"
              data-hs-go-to-options='{
              "targetSelector": "#jobs",
              "compensationSelector": "#logoAndNav",
              "offsetTop": 0,
              "position": null,
              "animationIn": false,
              "animationOut": false
              }'>
            {{ careers.hero__jobs_button }}
          </a>
        </div>

        <div class="row mx-n1 mx-sm-n2">
          <div class="col-4 align-self-end px-1 px-sm-2 mb-2 mb-sm-3">
            <div class="ml-md-8">
              <img class="img-fluid rounded" src="@@autopath/assets/img/900x900/img1.jpg">
            </div>
          </div>
          <div class="col-8 px-1 px-sm-2 mb-2 mb-sm-3">
            <img class="img-fluid rounded" src="@@autopath/assets/img/900x450/img14.jpg">
          </div>
          <div class="col-8 px-1 px-sm-2 mb-2 mb-sm-3">
            <img class="img-fluid rounded" src="@@autopath/assets/img/900x450/img13.jpg">
          </div>
          <div class="col-4 px-1 px-sm-2 mb-2 mb-sm-3">
            <div class="mr-md-8">
              <img class="img-fluid rounded" src="@@autopath/assets/img/750x750/img2.jpg">
            </div>
          </div>
        </div>
      </div>

      <div class="position-absolute top-0 right-0 left-0 w-100 h-100 bg-img-hero mt-n11" style="background-image: url(@@autopath/assets/svg/components/abstract-shapes-12.svg);"></div>

      <!-- SVG Shape -->
      <figure class="position-absolute bottom-0 right-0 left-0 mb-11">
        <svg preserveAspectRatio="none" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 1921 273">
          <polygon fill="#fff" points="0,273 1921,273 1921,0 "/>
        </svg>
      </figure>
      <!-- End SVG Shape -->
    </div>
    <!-- End Hero Section -->

    <!-- Company Values Section --> {# Features.General.Component#10 #}
    <div class="container">
      <div class="border-bottom space-2 space-lg-3">
        <!-- Title -->
        <div class="w-md-80 w-lg-50 text-center mx-md-auto mb-5 mb-md-9">
          <span class="d-block small font-weight-bold text-cap mb-2">{{ careers.company_values__title }}</span>
          <h2>{{ careers.company_values__subtitle }}</h2>
        </div>
        <!-- End Title -->

        <div class="row">
          {% for value in careers.company_values %}
            {% if loop.last or 
                ((loop.length % 3) == 0 and loop.revindex <= 3) or 
                (((loop.length + 1) % 3) == 0 and loop.revindex <= 2) %}
              {% set margin_sm = false %}
            {% else %}
              {% set margin_sm = true %}
            {% endif %}

            <div class="col-sm-6 col-md-4 mb-3 {% if margin_sm %} mb-sm-7 {% endif %}">
              <!-- Icon Blocks -->
              <div class="media">
                <span class="mr-3">&mdash;</span>
                <div class="media-body">
                  <h2 class="h4">{{ value.title }}</h2>
                  <p>{{ value.description }}</p>
                </div>
              </div>
              <!-- End Icon Blocks -->
            </div>
          {% endfor %}
        </div>
      </div>
    </div>
    <!-- End Company Values Section -->

    <!-- Our Values Section --> {# CustomSnippet #}
    <div class="container space-2 space-lg-3">
      <!-- Title -->
      <div class="w-md-80 w-lg-50 text-center mx-md-auto mb-5 mb-md-9">
        <span class="d-block small font-weight-bold text-cap mb-2">{{ careers.our_values__title }}</span>
        <h2>{{ careers.our_values__subtitle }}</h2>
      </div>
      <!-- End Title -->

      <div class="w-md-90 mx-md-auto">
        {% if careers.our_values__content.column_1 and careers.our_values__content.column_2 %}
        <div class="row">
          <div class="col-lg-6">
            {{ careers.our_values__content.column_1 | markdown | safe }}
          </div>
          <div class="col-lg-6">
            {{ careers.our_values__content.column_2 | markdown | safe  }}
          </div>
        </div>
        {% else %}
          {{ careers.our_values__content | markdown | safe }}
        {% endif %}
      </div>
    </div>
    <!-- End Our Values Section -->

    <!-- Gallery Section --> {# CustomSnippet #}
    <div class="container">
      <img class="img-fluid rounded" src="@@autopath/assets/img/1920x800/img3.jpg" alt="Image Description">
    </div>
    <!-- End Gallery Section -->

    <!-- Jobs Section --> {# Cards.List.Component#3 #}
    <div id="jobs" class="container space-2 space-lg-3">
      <!-- Title -->
      <div class="w-md-80 w-lg-50 text-center mx-md-auto mb-5 mb-md-7">
        <span class="d-block small font-weight-bold text-cap mb-2">{{ careers.jobs__title }}</span>
        <h2>{{ careers.jobs__subtitle }}</h2>
      </div>
      <!-- End Title -->

      <!-- Filters -->
      <div class="border-bottom pb-5 mb-7">
        <div class="row align-items-center">
          <div class="col-sm-auto mb-3 mb-sm-0">
            <!-- Select -->
            <select class="custom-select custom-select-sm" id="locationFilter">
              {# Each element is added via Javascript #}
            </select>
            <!-- End Select -->
          </div>

          <div class="col-sm text-sm-right">
            <span class="text-dark font-weight-bold">{{ careers_job.jobs | length }}</span>
            {% if careers_job.jobs | length == 1 %}
              {{ careers.jobs__vacancies.singular }}
            {% elif careers_job.jobs | length > 1 %}
              {{ careers.jobs__vacancies.plural }}
            {% endif %}
          </div>
        </div>
      </div>
      <!-- End Filters -->

      {% for department, items in careers_job.jobs | groupby("department") | dictsort  %}
        <!-- Title -->
        <div class="row justify-content-lg-between align-items-lg-center mt-7 mb-3 job-department" data-department="{{ department }}">
          <div class="col-sm-auto">
            <h3 class="h4">{{ department }}</h3>
          </div>
          <div class="col-sm text-sm-right">
            <small>
              {{ items | length }} 
              {% if items | length == 1 %}
                {{ careers.jobs__department_vacancies.singular }}
              {% elif items | length > 1 %}
                {{ careers.jobs__department_vacancies.plural }}
              {% endif %}
            </small>
          </div>
        </div>
        <!-- End Title -->

        {% for job in items %}
          <!-- Card -->
          <a class="card card-frame py-3 px-4 mb-2 job-container" href="./{{job.page.file_name}}" data-location="{{ job.location }}">
            <div class="row align-items-sm-center">
              <span class="col-sm-6 text-dark">
                {{ job.position }}
              </span>
              <span class="col-6 col-sm-3 text-body">
                {{ job.location }}
              </span>
              <span class="col-6 col-sm-3 text-right">
                {{ careers.jobs__job_link }} <i class="fas fa-angle-right fa-sm ml-1"></i>
              </span>
            </div>
          </a>
          <!-- End Card -->
        {% endfor %}
      {% endfor %}

      <div class="text-center mt-5">
        {{ careers.jobs__additional_info | markdown | safe }}
      </div>
    </div>
    <!-- End Jobs Section -->
	</main>
	<!-- ========== END MAIN ========== -->

  {% include "./partials/footer.html" %}

  {% include "./partials/go-to.html" %}
{% endblock %}

{% block js_plugins %}
	<!-- JS Implementing Plugins -->
  <!-- bundlejs:vendor [@@autopath] -->
  <script src="@@autopath/assets/vendor/hs-header/dist/hs-header.min.js"></script> <!-- Header --> {# HSLibraries.Headers #}
  <script src="@@autopath/assets/vendor/hs-mega-menu/dist/hs-mega-menu.min.js"></script> <!-- Header --> {# HSLibraries.HeaderMegaMenu #}
  <script src="@@autopath/assets/vendor/hs-unfold/dist/hs-unfold.min.js"></script> <!-- Footer --> {# OtherLibraries.Unfold #}
  <script src="@@autopath/assets/vendor/hs-go-to/dist/hs-go-to.min.js"></script> <!-- Go-to --> {# HSLibraries.Go-to #}

  <!-- JS Front -->
  <!-- bundlejs:theme [@@autopath] -->
  <script src="@@autopath/assets/js/hs.core.js"></script>

	<!-- JS Plugins Init. -->
	<script>
    $(document).on('ready', function () {
      // INITIALIZATION OF HEADER
      // =======================================================
      var header = new HSHeader($('#header')).init();

      // INITIALIZATION OF MEGA MENU
      // =======================================================
      var megaMenu = new HSMegaMenu($('.js-mega-menu')).init();

      // INITIALIZATION OF UNFOLD
      // =======================================================
      var unfold = new HSUnfold('.js-hs-unfold-invoker').init();

      // INITIALIZATION OF GO TO
      // =======================================================
      $('.js-go-to').each(function () {
        var goTo = new HSGoTo($(this)).init();
      });
    });
  </script>

  <!-- JS Custom -->
  <script>
    /* ------------------------------------------------------------ */
    /* -------------- LOCATION FILTER (JOBS SECTION) -------------- */
    /* ------------------------------------------------------------ */

    const jobs = {{ careers_job.jobs | dump | safe }};
    const $locationFilter = document.getElementById("locationFilter");
    const $jobDepartments = Array.from(document.getElementsByClassName('job-department'));
    const $jobContainers = Array.from(document.getElementsByClassName('job-container'));

    // Get the jobs and different locations available
    var jobsLocations = [];

    jobs.map(job => {
      if (!jobsLocations.includes(job.location)) {
        jobsLocations.push(job.location);
      }
    });

    // Add the different locations to the HTML filter
    addLocationsToFilter(jobsLocations);

    function addLocationsToFilter(locations) {
      let templateHTML = "";

      if(locations.length == 1){
        templateHTML = `<option value="${locations[0]}" selected>${locations[0]}</option>`;
      }else if(locations.length >= 2){
        templateHTML = "<option value='all' selected>All</option>";
        locations.map(location => {
            templateHTML += `<option value="${location}">${location}</option>`
        });
      }

      $locationFilter.innerHTML = templateHTML;
    }

    // Show or hide available jobs based on the location selected in the filter
    $locationFilter.addEventListener('change', showLocationJobs);

    function showLocationJobs(e){
      let currentLocation = $locationFilter.value;
      
      let activeDepartments = [];
      jobs.map(job => {
        if(!activeDepartments.includes(job.department) && (job.location == currentLocation || currentLocation == 'all')) {
          activeDepartments.push(job.department);
        }
      });

      $jobDepartments.map($department => {
        if(activeDepartments.includes($department.dataset.department)){
          $department.classList.remove('d-none');
        }else{
          $department.classList.add('d-none');
        }
      })

      $jobContainers.map($job => {
        if($job.dataset.location == currentLocation || currentLocation == 'all'){
          $job.classList.remove('d-none');
        }else{
          $job.classList.add('d-none');
        }
      })
    }
	</script>

  {% from "./partials/footer.html" import footerLanguageScript with context %}
  {{ footerLanguageScript() }}
{% endblock %}